window.__require=function t(e,o,r){function n(c,i){if(!o[c]){if(!e[c]){var u=c.split("/");if(u=u[u.length-1],!e[u]){var s="function"==typeof __require&&__require;if(!i&&s)return s(u,!0);if(a)return a(u,!0);throw new Error("Cannot find module '"+c+"'")}}var l=o[c]={exports:{}};e[c][0].call(l.exports,function(t){return n(e[c][1][t]||t)},l,l.exports,t,e,o,r)}return o[c].exports}for(var a="function"==typeof __require&&__require,c=0;c<r.length;c++)n(r[c]);return n}({Data:[function(t,e,o){"use strict";cc._RF.push(e,"a8e83DXus9IgoRG+hJX3gGV","Data"),Object.defineProperty(o,"__esModule",{value:!0});var r=t("./MathVec"),n=function(){function t(){var t=this;this.mergeSuper=function(t,e){for(var o=new Array,r=new Array,n=0,a=t;n<a.length;n++){var c=e(a[n]);o.push(c.arr),r.push(c.delta)}return{map:o,delta:r}},this.mergeLeft=function(e){var o,n,a,c=e.length,i=r.fillArray(0,e.length);for(o=0;o<c;o++){for(n=-1,a=o+1;a<c;a++)if(0!==e[a]){n=a,e[o]===e[a]?i[a]=a-o:0===e[o]?i[a]=a-o:i[a]=a-o-1;break}-1!==n&&(0===e[o]?(e[o]=e[n],e[n]=0,o-=1):e[o]===e[n]&&(e[o]=2*e[o],t.updateTimes=e[o]<t.maxValue?t.updateTimes+e[o]:t.updateTimes+1,e[n]=0))}return{arr:e,delta:i}},this.mergeRight=function(e){var o,n,a,c=e.length,i=r.fillArray(0,e.length);for(o=c-1;o>=0;o--){for(n=-1,a=o-1;a>=0;a--)if(0!==e[a]){n=a,e[a]===e[o]?i[a]=o-a:0===e[o]?i[a]=o-a:i[a]=o-a-1;break}-1!==n&&(0===e[o]?(e[o]=e[n],e[n]=0,o-=1):e[o]===e[n]&&(e[o]=2*e[o],t.updateTimes=e[o]<t.maxValue?t.updateTimes+e[o]:t.updateTimes+1,e[n]=0))}return{arr:e,delta:i}}}return t.getInstance=function(){return this.instance=this.instance?this.instance:new t,this.instance},t.prototype.init=function(t,e){return void 0===e&&(e=2048),this.updateTimes=0,this.maxValue=e,this.map=r.fillArraySuper(0,{raw:t,col:t}),this.__map=r.fillArraySuper(0,{raw:t,col:t}),this},Object.defineProperty(t.prototype,"data",{get:function(){return this.map},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"score",{get:function(){return this.updateTimes},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"MaxValue",{get:function(){return this.maxValue},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isChanged",{get:function(){return this.__map.toString()!==this.map.toString()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"result",{get:function(){return Boolean(Math.abs(this.updateTimes)%2)},enumerable:!0,configurable:!0}),t.prototype.merge=function(t,e){var o,n=this;switch(void 0===e&&(e=this.map),r.visitArray(this.map,function(t,e){n.__map[t][e]=n.map[t][e]}),t){case"left":var a=this.mergeSuper(e,this.mergeLeft);this.map=a.map,o=a.delta;break;case"right":a=this.mergeSuper(e,this.mergeRight);this.map=a.map,o=a.delta;break;case"up":a=this.mergeSuper(r.transformArray(e),this.mergeLeft);o=r.transformArray(a.delta),this.map=r.transformArray(a.map);break;case"down":a=this.mergeSuper(r.transformArray(e),this.mergeRight);o=r.transformArray(a.delta),this.map=r.transformArray(a.map);break;default:throw new Error("Data merge method error")}return o},Object.defineProperty(t.prototype,"isFull",{get:function(){var t=this;return this.hasNext=!1,r.visitArray(this.map,function(e,o){0===t.map[e][o]&&(t.hasNext=!0)}),!this.hasNext},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasTwice",{get:function(){return r.hasTwiceSuper(this.map)},enumerable:!0,configurable:!0}),t.prototype.addRand=function(t){var e=this;void 0===t&&(t=1);var o=r.PointList();return r.moreFunc(function(){if(r.visitArray(e.map,function(t,r){0===e.map[t][r]&&(o.push({x:t,y:r}),e.hasNext=!0)}),e.hasNext){var t=r.toInt(Math.random()*o.length);r.alterArray(e.map,{raw:o[t].x,col:o[t].y,value:2})}},t),this.hasNext},t}();o.default=n,cc._RF.pop()},{"./MathVec":"MathVec"}],EndScene:[function(t,e,o){"use strict";cc._RF.push(e,"b2955xherpKvIsmJKJ8gLIv","EndScene"),Object.defineProperty(o,"__esModule",{value:!0});var r=cc._decorator,n=r.ccclass,a=r.property,c=t("./Data"),i=t("./Model"),u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.score=null,e.title=null,e.restartBtn=null,e.maxValue=null,e}return __extends(e,t),e.prototype.onLoad=function(){this.maxValue=c.default.getInstance().MaxValue},e.prototype.start=function(){var t=this;c.default.getInstance().result?(this.title.string="Win! "+this.maxValue+"!",this.score.string=String(c.default.getInstance().score-1)):(this.title.string="Over",this.score.string=String(c.default.getInstance().score)),this.restartBtn.node.on("click",function(){i.default.getInstance().returnPreLayout(t.node),cc.director.loadScene("PlayScene")})},__decorate([a(cc.Label)],e.prototype,"score",void 0),__decorate([a(cc.Label)],e.prototype,"title",void 0),__decorate([a(cc.Button)],e.prototype,"restartBtn",void 0),e=__decorate([n],e)}(cc.Component);o.default=u,cc._RF.pop()},{"./Data":"Data","./Model":"Model"}],ILayout:[function(t,e,o){"use strict";cc._RF.push(e,"617fcKfdzpB1ZetnigMI+Rl","ILayout"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],IMathVec:[function(t,e,o){"use strict";cc._RF.push(e,"47286qu+/9M2LuK7IQ6aBi6","IMathVec"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],ITouchFront:[function(t,e,o){"use strict";cc._RF.push(e,"1d2daCpMx1MtKZ5AmY7sl+f","ITouchFront"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],Layout:[function(t,e,o){"use strict";cc._RF.push(e,"ac54eNKPPBPjoUWVTDdAodV","Layout"),Object.defineProperty(o,"__esModule",{value:!0});var r=t("./Model"),n=t("./MathVec"),a=function(){function t(t){var e=this;return this.color={2:cc.color(237,241,21,255),4:cc.color(241,180,21,255),8:cc.color(171,241,21,255),16:cc.color(149,160,216,255),32:cc.color(187,149,216,255),64:cc.color(216,149,209,255),128:cc.color(28,118,156,255),256:cc.color(16,74,99,255),512:cc.color(168,85,25,255),1024:cc.color(236,122,38,255),2048:cc.color(236,86,33,255)},this.initEdge=function(t){return e.edge=t,e.origin=cc.v2(t.width.start,-t.width.start),e.width=e.edge.width.end-e.edge.width.start,e},this.background=t,this}return t.prototype.draw=function(t){var e=this,o=this.width/(t.length-1);r.default.getInstance().clearNodeList(),n.visitArray(t,function(n,a){if(0!==t[n][a]){var c=cc.v2(e.origin.x+o*a,e.origin.y-o*n),i=r.default.getInstance().getBlock();i.setParent(e.background),i.setPosition(c),e.setNodeTarget(i,{raw:n,col:a}),i.getChildByName("label").getComponent(cc.Label).string=String(t[n][a]),i.color=e.color[String(t[n][a])],r.default.getInstance().saveNode(i)}})},t.prototype.action=function(t,e,o){var r=this;n.visitArray(e,function(n,a){0!==e[n][a]&&r.getNodeByTarget(r.background,{raw:n,col:a}).runAction(r.getAction(t,100*e[n][a],o))})},t.prototype.getAction=function(t,e,o){switch(void 0===o&&(o=.5),t){case"left":return cc.moveBy(o,cc.v2(-e,0));case"right":return cc.moveBy(o,cc.v2(e,0));case"up":return cc.moveBy(o,cc.v2(0,e));case"down":return cc.moveBy(o,cc.v2(0,-e));default:throw new Error("action command error")}},t.prototype.setNodeTarget=function(t,e){t.name=String(e.raw+""+e.col)},t.prototype.getNodeByTarget=function(t,e){return t.getChildByName(String(e.raw+""+e.col))},t}();o.default=a,cc._RF.pop()},{"./MathVec":"MathVec","./Model":"Model"}],MathVec:[function(t,e,o){"use strict";cc._RF.push(e,"b6f425xFSJKsK9yZt6CDGhx","MathVec"),Object.defineProperty(o,"__esModule",{value:!0});var r=function(){function t(t,e,o){this.start=t,this.step=e,this.num=o}return t.prototype.randPos=function(){var t=this.start+parseInt(String(Math.random()*this.num))*this.step;return cc.v2(t,t)},t.prototype.randVaule=function(){return this.start+parseInt(String(Math.random()*this.num*this.step))},t}();function n(t){for(var e=new Array,o=t.length,r=0;r<o;r++){e.push([]);for(var n=t[r].length,a=0;a<n;a++)e[r][a]=t[a][r]}return e}function a(t){return parseInt(String(t))}function c(t){for(var e=t.length,o=!1,r=0;r<e-1;r++)if(t[r]===t[r+1]){o=!0;break}return o}function i(t){for(var e=!1,o=0,r=t;o<r.length;o++){if(e=c(r[o]))break}return e}o.default=r,o.transformArray=n,o.visitArray=function(t,e){for(var o=t.length,r=0;r<o;r++)for(var n=t[r].length,a=0;a<n;a++)e(r,a)},o.visitArrayRand=function(t,e){var o=a(Math.random()*t.length);e(o,a(Math.random()*t[o].length))},o.moreFunc=function(t,e){void 0===e&&(e=1);var o=0,r=function(){o>=e||(o++,t(),r())};r()},o.toInt=a,o.randFunc=function(t,e){void 0===e&&(e=1.5);var o=Boolean(a(Math.random()*e));o&&t(o)},o.alterArray=function(t,e){t[e.raw][e.col]=e.value},o.computed=function(t,e,o){var r;switch(e){case"+":r=cc.v2(t.x+o.x,t.y+o.y);break;case"-":r=cc.v2(t.x-o.x,t.y-o.y);break;case"*":r=cc.v2(t.x*o.x,t.y*o.y);break;case"/":r=cc.v2(t.x/o.x,t.y/o.y);break;default:throw new Error("computed method unknown")}return r},o.PointList=function(){return new Array},o.judgePos=function(t,e){return t.x===e.x&&t.y===e.y},o.fillArray=function(t,e){void 0===e&&(e=1);for(var o=new Array,r=0;r<e;r++)o.push(t);return o},o.fillArraySuper=function(t,e){for(var o=new Array,r=0;r<e.raw;r++){o.push([]);for(var n=0;n<e.col;n++)o[r][n]=t}return o},o.hasTwice=c,o.testRows=i,o.hasTwiceSuper=function(t){var e,o;return e=i(t),o=i(n(t)),e||o},cc._RF.pop()},{}],Model:[function(t,e,o){"use strict";cc._RF.push(e,"f851aLWv9ZDdIy6K3/l716G","Model"),Object.defineProperty(o,"__esModule",{value:!0});var r=function(){function t(){this._BlockPool=new cc.NodePool,this._layoutCache=new cc.NodePool,this._nodeList=new Array}return t.getInstance=function(){return this.instance=this.instance?this.instance:new t,this.instance},t.prototype.initPool=function(t,e){for(var o=0;o<e;++o){var r=cc.instantiate(t);this._BlockPool.put(r)}return this._prafab=t,this},t.prototype.initPreLayout=function(t){var e=cc.instantiate(t);return this._layoutCache.put(e),this},t.prototype.getPreLayout=function(){return this._layoutCache.size()>0?this._layoutCache.get():null},t.prototype.returnPreLayout=function(t){this._layoutCache.put(t)},Object.defineProperty(t.prototype,"NodeList",{get:function(){return this._nodeList},enumerable:!0,configurable:!0}),t.prototype.getBlock=function(){return this._BlockPool.size()>0?this._BlockPool.get():cc.instantiate(this._prafab)},t.prototype.saveNode=function(t){this._nodeList.push(t)},t.prototype.clearNodeList=function(){for(var t=0,e=this._nodeList;t<e.length;t++){var o=e[t];this._BlockPool.put(o),this._nodeList=[]}},t.prototype.ClearPool=function(){this._nodeList=[],this._BlockPool.clear(),this._layoutCache.clear()},t}();o.default=r,cc._RF.pop()},{}],PlayScene:[function(t,e,o){"use strict";cc._RF.push(e,"e9c8bH5ZM1BD4/aKPa9BMFF","PlayScene"),Object.defineProperty(o,"__esModule",{value:!0});var r=cc._decorator,n=r.ccclass,a=r.property,c=t("./TouchBlock"),i=t("./TouchFront"),u=t("./Layout"),s=t("./Model"),l=t("./Data"),h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.background=null,e.layout=null,e.blockPrefab=null,e.gameEnd=null,e.score=null,e}return __extends(e,t),e.prototype.onLoad=function(){s.default.getInstance().initPool(this.blockPrefab,16).initPreLayout(this.gameEnd),l.default.getInstance().init(4,8).addRand(2)},e.prototype.start=function(){var t=new u.default(this.layout.node);t.initEdge({width:{start:-150,end:150}}).draw(l.default.getInstance().data),new c.default(new i.default(this.background.node),t,this.score).load()},e.prototype.onDestroy=function(){s.default.getInstance().ClearPool()},__decorate([a(cc.Sprite)],e.prototype,"background",void 0),__decorate([a(cc.Sprite)],e.prototype,"layout",void 0),__decorate([a(cc.Prefab)],e.prototype,"blockPrefab",void 0),__decorate([a(cc.Prefab)],e.prototype,"gameEnd",void 0),__decorate([a(cc.Label)],e.prototype,"score",void 0),e=__decorate([n],e)}(cc.Component);o.default=h,cc._RF.pop()},{"./Data":"Data","./Layout":"Layout","./Model":"Model","./TouchBlock":"TouchBlock","./TouchFront":"TouchFront"}],SceneGO:[function(t,e,o){"use strict";cc._RF.push(e,"94aadNOQ25Lz7ocijwOXGg9","SceneGO"),Object.defineProperty(o,"__esModule",{value:!0});var r=cc._decorator,n=r.ccclass,a=r.property,c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.button=null,e.target=null,e}return __extends(e,t),e.prototype.start=function(){var t=this;this.button.node.on("click",function(){cc.director.loadScene(t.target.name)})},__decorate([a({type:cc.Button,displayName:"\u5207\u6362\u6309\u94ae"})],e.prototype,"button",void 0),__decorate([a({type:cc.SceneAsset,displayName:"\u76ee\u6807\u573a\u666f"})],e.prototype,"target",void 0),e=__decorate([n],e)}(cc.Component);o.default=c,cc._RF.pop()},{}],TouchBlock:[function(t,e,o){"use strict";cc._RF.push(e,"4d7b1DBXclKtKexYcerzVy/","TouchBlock"),Object.defineProperty(o,"__esModule",{value:!0});var r=t("./Data"),n=t("./Model"),a=function(){function t(t,e,o){var a=this;this.load=function(){a.touchFront.submit(a.left,a.right,a.up,a.down).listen()},this.left=function(){a.layoutStep("left")},this.right=function(){a.layoutStep("right")},this.up=function(){a.layoutStep("up")},this.down=function(){a.layoutStep("down")},this.testResult=function(){a._score.string=String(a.DataStn.score),a.DataStn.result?(a.gameEnd(),a._score.string=String(a.DataStn.score-1)):a.DataStn.isFull&&(a.DataStn.hasTwice||(a._score.string=String(a.DataStn.score),a.gameEnd()))},this.gameEnd=function(){var t=n.default.getInstance().getPreLayout();null!==t&&(t.setParent(cc.director.getScene()),t.setPosition(cc.winSize.width/2,cc.winSize.height/2))},this.touchFront=t,this.layout=e,this._score=o,this.DataStn=r.default.getInstance()}return t.prototype.layoutStep=function(t,e){var o=this;void 0===e&&(e=.2);var r=this.DataStn.merge(t);this.layout.action(t,r,e),setTimeout(function(){o.layout.draw(o.DataStn.data)},1100*e),this.DataStn.isChanged&&this.DataStn.addRand(),this.testResult()},t}();o.default=a,cc._RF.pop()},{"./Data":"Data","./Model":"Model"}],TouchFront:[function(t,e,o){"use strict";cc._RF.push(e,"aa7baAl6mJJv4sTM1+od13I","TouchFront"),Object.defineProperty(o,"__esModule",{value:!0});var r=function(){return function(t,e,o){void 0===e&&(e=100),void 0===o&&(o=200);var r=this;this.submit=function(t,e,o,n){return r.callbackLeft=t,r.callbackRight=e,r.callbackUp=o,r.callbackDown=n,r},this.listen=function(){var t;r.node.on(cc.Node.EventType.TOUCH_START,function(e){return t=e.getLocation()}),r.node.on(cc.Node.EventType.TOUCH_MOVE,function(t){r._lock++}),r.node.on(cc.Node.EventType.TOUCH_END,function(e){r._lock<r.delta&&r.testPos(t,e.getLocation()),r._lock=0}),r.node.on(cc.Node.EventType.TOUCH_CANCEL,function(e){r._lock<r.delta&&r.testPos(t,e.getLocation()),r._lock=0})},this.testPos=function(t,e){Math.abs(e.x-t.x)<r.offset&&Math.abs(e.y-t.y)<r.offset||(Math.abs(e.x-t.x)>Math.abs(e.y-t.y)?e.x-t.x>r.offset?r.callbackRight&&r.callbackRight():e.x-t.x<-r.offset&&r.callbackLeft&&r.callbackLeft():e.y-t.y>r.offset?r.callbackUp&&r.callbackUp():e.y-t.y<-r.offset&&r.callbackDown&&r.callbackDown())},this.node=t,this.offset=e,this._lock=0,this.delta=o}}();o.default=r,cc._RF.pop()},{}]},{},["Data","EndScene","ILayout","IMathVec","ITouchFront","Layout","MathVec","Model","PlayScene","SceneGO","TouchBlock","TouchFront"]);